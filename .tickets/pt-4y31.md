---
id: pt-4y31
status: closed
deps: [pt-6hpl, pt-pbpm]
links: [pt-6hpl, pt-m387]
created: 2026-02-09T13:26:39Z
type: task
priority: 2
assignee: legout
external-ref: spike-datastar-py-sanic-datastar-tf-web-ui
tags: [tf, backlog, component:api, component:cli, component:docs, component:workflow]
---
# Implement /api/refresh as DatastarResponse (multi-target SSE patch)

## Task
Change the Sanic `/api/refresh` endpoint to return a datastar-py `DatastarResponse` with SSE events that patch both the board and the counts.

## Context
datastar-py provides `ServerSentEventGenerator.patch_elements()` for correctly formatted SSE events. This enables multi-target updates from one action.

## Acceptance Criteria
- [ ] `/api/refresh` returns `DatastarResponse([...])` with at least 2 `patch_elements` events:
  - [ ] patch `#board` with the rendered board fragment
  - [ ] patch `#board-stats` with the rendered counts fragment (or counts container)
- [ ] Manual refresh button still works (no JS changes needed beyond existing Datastar usage).
- [ ] If board data fails to load, endpoint returns a reasonable error response (HTML or SSE).

## Constraints
- Keep templates server-rendered with Jinja2 (no client-side component rewrite).

## References
- Spike: spike-datastar-py-sanic-datastar-tf-web-ui



## Notes

**2026-02-09T14:26:10Z**

Implemented /api/refresh as DatastarResponse with multi-target SSE patches.

Changes:
- Updated web_app.py to use DatastarResponse with ServerSentEventGenerator.patch_elements()
- Added _board_stats.html template for stats fragment
- Added id='board-stats' to stats container in index.html

The endpoint now patches both #board and #board-stats from a single request.

Commit: c47c77f
